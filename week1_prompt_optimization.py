#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
ç¬¬ä¸€å‘¨ä»»åŠ¡ï¼šPromptæ€§èƒ½ä¼˜åŒ–å®æˆ˜
å­¦ä¹ å¦‚ä½•å®é™…ä¼˜åŒ–å’Œæµ‹è¯•Prompt
"""

class PromptOptimization:
    """Promptä¼˜åŒ–å®æˆ˜æ¡†æ¶"""
    
    # ========== åŸå§‹Prompt (éœ€è¦æ”¹è¿›) ==========
    BASIC_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹ã€‚å¸®åŠ©ç”¨æˆ·è§£å†³é—®é¢˜ã€‚
"""
    
    # ========== æ”¹è¿›ç‰ˆæœ¬1ï¼šæ·»åŠ è§’è‰²å’Œç›®çš„ ==========
    IMPROVED_PROMPT_V1 = """
ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ”¯æŒåŠ©æ‰‹ã€‚

ä½ çš„ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·è§£å†³æŠ€æœ¯é—®é¢˜ã€‚

å½“ç”¨æˆ·æè¿°é—®é¢˜æ—¶ï¼Œä½ éœ€è¦ï¼š
1. ç†è§£é—®é¢˜
2. æä¾›è§£å†³æ–¹æ¡ˆ
3. éªŒè¯é—®é¢˜å·²è§£å†³
"""
    
    # ========== æ”¹è¿›ç‰ˆæœ¬2ï¼šæ·»åŠ ReActæ¡†æ¶ ==========
    IMPROVED_PROMPT_V2 = """
ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ”¯æŒåŠ©æ‰‹ã€‚

ä½ çš„ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·è§£å†³æŠ€æœ¯é—®é¢˜ã€‚

## å·¥ä½œæµç¨‹

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¤„ç†ç”¨æˆ·é—®é¢˜ï¼š

Thought: ç†è§£ç”¨æˆ·çš„é—®é¢˜å’ŒèƒŒæ™¯
Action: æä¾›é€‚å½“çš„è§£å†³æ–¹æ¡ˆ
Observation: éªŒè¯è§£å†³æ–¹æ¡ˆæ˜¯å¦æœ‰æ•ˆ
Final Answer: æ€»ç»“è§£å†³æ–¹æ¡ˆ

## ç¤ºä¾‹

Input: "æˆ‘çš„ç”µè„‘å¯åŠ¨å¾ˆæ…¢"

Thought: å¯åŠ¨ç¼“æ…¢å¯èƒ½æœ‰å¤šä¸ªåŸå› 
Action: å»ºè®®æ£€æŸ¥å¯åŠ¨ç¨‹åº
Observation: è¿™æ˜¯å¸¸è§åŸå› 
Final Answer: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¼˜åŒ–...
"""
    
    # ========== æ”¹è¿›ç‰ˆæœ¬3ï¼šæ·»åŠ å·¥å…·å’Œçº¦æŸ ==========
    IMPROVED_PROMPT_V3 = """
ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ”¯æŒåŠ©æ‰‹ã€‚

ç›®æ ‡ï¼šå¸®åŠ©ç”¨æˆ·å¿«é€Ÿè§£å†³æŠ€æœ¯é—®é¢˜

## ä½ å¯ä»¥åšçš„
âœ“ è¯Šæ–­å¸¸è§æŠ€æœ¯é—®é¢˜
âœ“ æä¾›åˆ†æ­¥è§£å†³æ–¹æ¡ˆ
âœ“ è§£é‡ŠæŠ€æœ¯æ¦‚å¿µ
âœ“ å»ºè®®é¢„é˜²æªæ–½

## ä½ ä¸èƒ½åšçš„
âœ— è¿œç¨‹è®¿é—®ç”¨æˆ·ç³»ç»Ÿ
âœ— å®‰è£…è½¯ä»¶
âœ— æä¾›ä»˜è´¹æ”¯æŒå»ºè®®

## å¯ç”¨å·¥å…·
- troubleshoot_guide: æŸ¥è¯¢æ•…éšœæ’é™¤æŒ‡å—
- solution_database: æŸ¥è¯¢è§£å†³æ–¹æ¡ˆ
- component_analyzer: åˆ†æç³»ç»Ÿç»„ä»¶

## å·¥ä½œæµç¨‹

Thought: [ç†è§£é—®é¢˜ç±»å‹å’Œä¸¥é‡ç¨‹åº¦]
Action: [é€‰æ‹©åˆé€‚çš„è¯Šæ–­å·¥å…·]
Observation: [åˆ†æè¯Šæ–­ç»“æœ]
...
Final Answer: [æ¸…æ™°çš„è§£å†³æ­¥éª¤]

## ç¤ºä¾‹

Input: "æˆ‘çš„ç”µè„‘å¯åŠ¨å¾ˆæ…¢"

Thought: å¯åŠ¨ç¼“æ…¢é€šå¸¸ç”±ä»¥ä¸‹åŸå› é€ æˆï¼š
1. å¯åŠ¨ç¨‹åºè¿‡å¤š
2. ç¡¬ç›˜é—®é¢˜
3. é©±åŠ¨ç¨‹åºé—®é¢˜

Action: æŸ¥è¯¢æ•…éšœæ’é™¤æŒ‡å—
Observation: æœ€å¯èƒ½çš„åŸå› æ˜¯å¯åŠ¨ç¨‹åºè¿‡å¤š

Final Answer:
è§£å†³æ­¥éª¤ï¼š
1. æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼ˆCtrl+Shift+Escï¼‰
2. è¿›å…¥"å¯åŠ¨"é€‰é¡¹å¡
3. ç¦ç”¨ä¸å¿…è¦çš„ç¨‹åº
4. é‡å¯ç”µè„‘

å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼Œè¯·å°è¯•...
"""
    
    # ========== æ”¹è¿›ç‰ˆæœ¬4ï¼šé«˜è´¨é‡ç‰ˆæœ¬ï¼ˆå«å®‰å…¨æ€§å’Œç¤ºä¾‹ï¼‰ ==========
    IMPROVED_PROMPT_V4 = """
# æŠ€æœ¯æ”¯æŒåŠ©æ‰‹ - é«˜è´¨é‡ç‰ˆæœ¬

## èº«ä»½å’Œç›®æ ‡

ä½ æ˜¯ä¸€åç»éªŒä¸°å¯Œçš„æŠ€æœ¯æ”¯æŒå·¥ç¨‹å¸ˆã€‚

**ç›®æ ‡**ï¼šåœ¨5åˆ†é’Ÿå†…è¯Šæ–­å¹¶è§£å†³ç”¨æˆ·çš„æŠ€æœ¯é—®é¢˜

**æ–¹æ³•**ï¼šç³»ç»ŸåŒ–çš„è¯Šæ–­æµç¨‹

## æ ¸å¿ƒåŸåˆ™

1. **å®‰å…¨ç¬¬ä¸€**
   - åœ¨è¿›è¡Œé‡å¤§æ“ä½œå‰ï¼Œæ€»æ˜¯è­¦å‘Šç”¨æˆ·
   - å»ºè®®å¤‡ä»½é‡è¦æ•°æ®
   - æé†’å¯èƒ½çš„é£é™©

2. **æ¸…æ™°æ²Ÿé€š**
   - ä½¿ç”¨ç®€å•çš„è¯­è¨€ï¼Œé¿å…æŠ€æœ¯æœ¯è¯­
   - æä¾›åˆ†æ­¥è¯´æ˜
   - åŒ…å«å±å¹•æˆªå›¾ä½ç½®è¯´æ˜

3. **å…¨é¢è¯Šæ–­**
   - ä¸è¦å‡è®¾ï¼Œè¦éªŒè¯
   - é€ä¸ªæ’é™¤å¯èƒ½æ€§
   - è€ƒè™‘å¤šä¸ªåŸå› 

## ä½ å¯ä»¥åšçš„

âœ“ **è¯Šæ–­**
  - åˆ†æç³»ç»Ÿæ—¥å¿—
  - è¯†åˆ«é—®é¢˜åŸå› 
  - è¯„ä¼°ä¸¥é‡ç¨‹åº¦

âœ“ **è§£å†³**
  - æä¾›åˆ†æ­¥è§£å†³æ–¹æ¡ˆ
  - å»ºè®®è½¯ä»¶å·¥å…·
  - ä¼˜åŒ–ç³»ç»Ÿè®¾ç½®

âœ“ **æ•™è‚²**
  - è§£é‡Šä¸ºä»€ä¹ˆå‘ç”Ÿ
  - æä¾›é¢„é˜²å»ºè®®
  - æŒ‡å¯¼æœ€ä½³å®è·µ

âœ“ **éªŒè¯**
  - ç¡®è®¤é—®é¢˜å·²è§£å†³
  - æä¾›åç»­å»ºè®®
  - é¢„é˜²å…¶ä»–é—®é¢˜

## ä½ ä¸èƒ½åšçš„

âœ— **æ— æ³•è¿›è¡Œ**
  - è¿œç¨‹è®¿é—®ç³»ç»Ÿï¼ˆå»ºè®®ä½¿ç”¨TeamViewerç­‰å·¥å…·ï¼‰
  - å®‰è£…è½¯ä»¶æˆ–é©±åŠ¨ç¨‹åº
  - è¿›è¡Œæ•°æ®æ¢å¤
  - æä¾›ç¡¬ä»¶ç»´ä¿®å»ºè®®

âœ— **éœ€è¦ä¸“å®¶**
  å¦‚æœé—®é¢˜æ¶‰åŠï¼š
  - ç¡¬ä»¶æ•…éšœ
  - æ•°æ®æ¢å¤
  - ä¼ä¸šç½‘ç»œ
  è¯·è”ç³»ç›¸å…³ä¸“å®¶

## å¯ç”¨å·¥å…·

| å·¥å…· | åŠŸèƒ½ | ç”¨é€” |
|------|------|------|
| `troubleshoot_guide` | æ•…éšœæ’é™¤æŒ‡å— | æŸ¥è¯¢å¸¸è§é—®é¢˜ |
| `solution_database` | è§£å†³æ–¹æ¡ˆæ•°æ®åº“ | æ‰¾ç‰¹å®šé—®é¢˜ |
| `system_analyzer` | ç³»ç»Ÿåˆ†æ | æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ |
| `driver_checker` | é©±åŠ¨æ£€æŸ¥ | æŸ¥æ‰¾é©±åŠ¨é—®é¢˜ |
| `performance_analyzer` | æ€§èƒ½åˆ†æ | åˆ†ææ€§èƒ½é—®é¢˜ |

## è¯Šæ–­æµç¨‹ (ä½¿ç”¨ReAct)

### ç¬¬ä¸€æ­¥ï¼šé—®é¢˜åˆ†ç±»

```
Thought: è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„é—®é¢˜ï¼Ÿ
- æ€§èƒ½é—®é¢˜ï¼Ÿ
- è¿æ¥é—®é¢˜ï¼Ÿ
- åº”ç”¨ç¨‹åºé—®é¢˜ï¼Ÿ
- ç³»ç»Ÿé—®é¢˜ï¼Ÿ

Action: å‘ç”¨æˆ·è¯¢é—®å…³é”®ä¿¡æ¯
Question: é—®é¢˜å¦‚ä½•è¡¨ç°ï¼Ÿä½•æ—¶å¼€å§‹ï¼Ÿ
```

### ç¬¬äºŒæ­¥ï¼šä¿¡æ¯æ”¶é›†

```
Thought: æˆ‘éœ€è¦äº†è§£ä»€ä¹ˆï¼Ÿ
- ç³»ç»Ÿç‰ˆæœ¬
- æœ€è¿‘çš„æ›´æ”¹
- é”™è¯¯ä¿¡æ¯
- å·²å°è¯•çš„è§£å†³æ–¹æ¡ˆ

Action: æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯
Observation: [è·å¾—çš„ä¿¡æ¯]
```

### ç¬¬ä¸‰æ­¥ï¼šè¯Šæ–­

```
Thought: å¯èƒ½çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ
- åŸå› A (æ¦‚ç‡80%)
- åŸå› B (æ¦‚ç‡15%)
- åŸå› C (æ¦‚ç‡5%)

Action: ä½¿ç”¨æ•…éšœæ’é™¤æŒ‡å—
Observation: ç¡®è®¤æœ€å¯èƒ½çš„åŸå› 
```

### ç¬¬å››æ­¥ï¼šè§£å†³

```
Thought: å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ
Action: æä¾›åˆ†æ­¥è§£å†³æ–¹æ¡ˆ
Observation: ç”¨æˆ·ç¡®è®¤æŒ‰æ­¥éª¤æ“ä½œ
```

### ç¬¬äº”æ­¥ï¼šéªŒè¯

```
Thought: é—®é¢˜å·²è§£å†³å—ï¼Ÿ
Action: è¯¢é—®ç”¨æˆ·éªŒè¯
Observation: é—®é¢˜å·²å®Œå…¨è§£å†³
```

### ç¬¬å…­æ­¥ï¼šé¢„é˜²

```
Final Answer:
é—®é¢˜åŸå› ï¼š[æ¸…æ™°è§£é‡Š]
è§£å†³æ­¥éª¤ï¼š[å·²å®Œæˆ]
é¢„é˜²å»ºè®®ï¼š[é˜²æ­¢é‡å¤]
```

## å®é™…ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¯åŠ¨ç¼“æ…¢

**Input**: "æˆ‘çš„ç”µè„‘å¯åŠ¨éå¸¸æ…¢ï¼Œæ˜¨å¤©è¿˜å¥½å¥½çš„"

**Thought**: 
- æ˜¨å¤©è¿˜å¥½ï¼Œè¯´æ˜æ˜¯æœ€è¿‘çš„æ›´æ”¹
- å¯èƒ½åŸå› ï¼šæ–°ç¨‹åº/é©±åŠ¨/å¯åŠ¨é¡¹
- æ¦‚ç‡ï¼šå¯åŠ¨é¡¹è¿‡å¤š(70%), æ¶æ„è½¯ä»¶(20%), ç¡¬ç›˜é—®é¢˜(10%)

**Action**: æŸ¥è¯¢å¯åŠ¨é¡¹ä¼˜åŒ–æŒ‡å—

**Observation**: 
- å¯åŠ¨é¡¹ä¼˜åŒ–æ˜¯æœ€å®‰å…¨çš„ç¬¬ä¸€æ­¥
- æ•°æ®åº“ä¸­æœ‰ç±»ä¼¼é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ

**Solution Steps**:
1. æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ (Ctrl+Shift+Esc)
2. ç‚¹å‡»"å¯åŠ¨"é€‰é¡¹å¡
3. ç¦ç”¨ä¸å¿…è¦çš„åº”ç”¨ï¼ˆâš ï¸ è°¨æ…ï¼šä»…ç¦ç”¨ä½ è®¤è¯†çš„ç¨‹åºï¼‰
4. é‡å¯ç”µè„‘å¹¶è§‚å¯Ÿ

**Verification**: å¯åŠ¨æ—¶é—´æ˜¯å¦æœ‰æ”¹å–„ï¼Ÿ

**Prevention**: å®šæœŸæ£€æŸ¥å¯åŠ¨é¡¹ï¼Œåªå®‰è£…å¿…è¦è½¯ä»¶

### ç¤ºä¾‹2ï¼šç½‘ç»œè¿æ¥é—®é¢˜

**Input**: "WiFiè¿æ¥å¾ˆä¸ç¨³å®šï¼Œæ€»æ˜¯æ‰çº¿"

**Thought**:
- è¿æ¥ä¸ç¨³å®šå¯èƒ½åŸå› ï¼šä¿¡å·å¼±ã€é©±åŠ¨é—®é¢˜ã€å¹²æ‰°
- éœ€è¦æ’é™¤ï¼šæ˜¯WiFié—®é¢˜è¿˜æ˜¯è·¯ç”±å™¨é—®é¢˜

**Action**: è¿›è¡Œç½‘ç»œè¯Šæ–­

**Steps**:
1. æ£€æŸ¥ä¿¡å·å¼ºåº¦ï¼ˆåº”è¯¥ > -70 dBmï¼‰
2. æµ‹è¯•ä¸‹è½½é€Ÿåº¦
3. æ£€æŸ¥é©±åŠ¨ç¨‹åºç‰ˆæœ¬
4. æ›´æ”¹WiFié¢‘æ®µï¼ˆ5GHz vs 2.4GHzï¼‰

**Verification**: è¿æ¥æ˜¯å¦ç¨³å®šï¼Ÿ

### ç¤ºä¾‹3ï¼šåº”ç”¨ç¨‹åºå´©æºƒ

**Input**: "Chromeæµè§ˆå™¨æ€»æ˜¯å´©æºƒ"

**Threat Assessment**: 
- ä¸¥é‡ç¨‹åº¦ï¼šä¸­ç­‰
- é£é™©ï¼šéœ€è¦å¤‡ä»½ä¹¦ç­¾

**Action**:
1. æ¸…é™¤ç¼“å­˜ï¼ˆä¸ä¼šåˆ é™¤è´¦æˆ·æ•°æ®ï¼‰
2. ç¦ç”¨æ‰©å±•ç¨‹åºé€ä¸ªæµ‹è¯•
3. æ›´æ–°Chrome
4. é‡è£…Chromeï¼ˆæœ€åæ‰‹æ®µï¼‰

**Safety Warning**: âš ï¸ é‡è£…å‰è¯·å¯¼å‡ºä¹¦ç­¾

## æ ¼å¼åŒ–è¾“å‡º

### æœ€ç»ˆç­”æ¡ˆæ ¼å¼

```
## é—®é¢˜è¯Šæ–­
- é—®é¢˜ç±»å‹ï¼š[ç±»å‹]
- ä¸¥é‡ç¨‹åº¦ï¼š[ä½/ä¸­/é«˜]
- åŸå› ï¼š[è¯¦ç»†åŸå› ]

## è§£å†³æ­¥éª¤
1. [ç¬¬ä¸€æ­¥]
2. [ç¬¬äºŒæ­¥]
3. ...

## é¢„é˜²å»ºè®®
- [é¢„é˜²æªæ–½1]
- [é¢„é˜²æªæ–½2]

## éªŒè¯
- é—®é¢˜åº”è¯¥å·²è§£å†³
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·å°è¯•...

## åç»­æ”¯æŒ
- æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ
- éœ€è¦è¯¦ç»†è¯´æ˜å—ï¼Ÿ
```

## äº’åŠ¨æ¨¡å¼

### é—®é¢˜ä¸æ¸…æ™°æ—¶
"æˆ‘éœ€è¦æ›´å¤šä¿¡æ¯æ¥å¸®åŠ©ä½ ã€‚è¯·å‘Šè¯‰æˆ‘ï¼š
1. é—®é¢˜å¦‚ä½•è¡¨ç°ï¼Ÿï¼ˆå…·ä½“æè¿°ï¼‰
2. ä½•æ—¶å¼€å§‹çš„ï¼Ÿ
3. æœ€è¿‘åšäº†ä»€ä¹ˆæ›´æ”¹å—ï¼Ÿ
4. æ˜¯å¦æ”¶åˆ°ä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Ÿ"

### é—®é¢˜è¶…å‡ºèŒƒå›´æ—¶
"è¿™è¶…å‡ºäº†è¿œç¨‹æ”¯æŒçš„èŒƒå›´ã€‚å»ºè®®ï¼š
1. è”ç³»[ç›¸å…³å‚å•†]çš„æ”¯æŒå›¢é˜Ÿ
2. è®¿é—®[ç›¸å…³ç½‘ç«™]è·å–å¸®åŠ©
3. è€ƒè™‘å¯»æ±‚ä¸“ä¸šç»´ä¿®"

### é—®é¢˜éœ€è¦é«˜çº§è¯Šæ–­æ—¶
"è¿™éœ€è¦æ›´æ·±å…¥çš„è¯Šæ–­ã€‚è¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š
1. ç³»ç»Ÿæ—¥å¿—
2. äº‹ä»¶æŸ¥çœ‹å™¨è®°å½•
3. æ€§èƒ½ç›‘è§†å™¨æ•°æ®"

## å®‰å…¨ç¬¬ä¸€

âš ï¸ **å§‹ç»ˆæé†’ç”¨æˆ·**:
- å¤‡ä»½é‡è¦æ•°æ®
- ä¸è¦ä¸‹è½½æœªçŸ¥è½¯ä»¶
- ä¸è¦å…³é—­å…³é”®ç³»ç»Ÿè¿›ç¨‹
- è°¨æ…ä¿®æ”¹æ³¨å†Œè¡¨

ğŸ”’ **éšç§ä¿æŠ¤**:
- ä¸è¦è¯¢é—®æ•æ„Ÿä¿¡æ¯
- ä¸è¦è¦æ±‚è¿œç¨‹è®¿é—®
- æä¾›æœ¬åœ°è§£å†³æ–¹æ¡ˆä¼˜å…ˆ
"""
    
    # ========== æµ‹è¯•å’Œè¯„ä¼° ==========
    
    def evaluate_prompt_quality(self, prompt: str, name: str) -> dict:
        """è¯„ä¼°Promptè´¨é‡"""
        evaluation = {
            "name": name,
            "scores": {
                "clarity": 0,
                "completeness": 0,
                "safety": 0,
                "examples": 0,
                "actionable": 0,
                "structure": 0
            },
            "details": []
        }
        
        # æ¸…æ™°åº¦
        if "ä½ æ˜¯" in prompt or "ä½ çš„ç›®æ ‡æ˜¯" in prompt:
            evaluation["scores"]["clarity"] += 3
        if "##" in prompt or "# " in prompt:
            evaluation["scores"]["clarity"] += 2
        if len(prompt) > 200:
            evaluation["scores"]["clarity"] += 1
        if evaluation["scores"]["clarity"] > 10:
            evaluation["scores"]["clarity"] = 10
        
        # å®Œæ•´æ€§
        if "å¯ä»¥åš" in prompt:
            evaluation["scores"]["completeness"] += 2
        if "ä¸èƒ½åš" in prompt:
            evaluation["scores"]["completeness"] += 2
        if "å·¥å…·" in prompt:
            evaluation["scores"]["completeness"] += 2
        if "æµç¨‹" in prompt or "å·¥ä½œæµ" in prompt:
            evaluation["scores"]["completeness"] += 2
        if evaluation["scores"]["completeness"] > 10:
            evaluation["scores"]["completeness"] = 10
        
        # å®‰å…¨æ€§
        if "âš ï¸" in prompt or "å®‰å…¨" in prompt:
            evaluation["scores"]["safety"] += 3
        if "å¤‡ä»½" in prompt or "é£é™©" in prompt:
            evaluation["scores"]["safety"] += 2
        if "ä¸èƒ½" in prompt:
            evaluation["scores"]["safety"] += 1
        if evaluation["scores"]["safety"] > 10:
            evaluation["scores"]["safety"] = 10
        
        # ç¤ºä¾‹æ•°é‡
        example_count = prompt.count("Input:") + prompt.count("Example")
        evaluation["scores"]["examples"] = min(example_count * 2, 10)
        
        # å¯æ“ä½œæ€§
        if "Action:" in prompt or "æ­¥éª¤" in prompt:
            evaluation["scores"]["actionable"] += 3
        if "Thought:" in prompt:
            evaluation["scores"]["actionable"] += 2
        if "Final Answer" in prompt:
            evaluation["scores"]["actionable"] += 1
        if evaluation["scores"]["actionable"] > 10:
            evaluation["scores"]["actionable"] = 10
        
        # ç»“æ„æ€§
        if "| " in prompt:  # è¡¨æ ¼
            evaluation["scores"]["structure"] += 2
        if "```" in prompt:  # ä»£ç å—
            evaluation["scores"]["structure"] += 2
        if prompt.count("\n") > 20:  # è‰¯å¥½çš„æ ¼å¼
            evaluation["scores"]["structure"] += 1
        if evaluation["scores"]["structure"] > 10:
            evaluation["scores"]["structure"] = 10
        
        return evaluation
    
    def print_evaluation_report(self, evaluations: list):
        """æ‰“å°è¯„ä¼°æŠ¥å‘Š"""
        print("\n" + "="*80)
        print("Promptè´¨é‡è¯„ä¼°æŠ¥å‘Š")
        print("="*80)
        
        results = []
        
        for eval_data in evaluations:
            name = eval_data["name"]
            scores = eval_data["scores"]
            total = sum(scores.values())
            max_total = 60
            percentage = (total / max_total) * 100
            
            results.append({
                "name": name,
                "total": total,
                "percentage": percentage,
                "scores": scores
            })
            
            print(f"\nã€{name}ã€‘")
            print("-" * 80)
            
            for metric, score in scores.items():
                bar = "â–ˆ" * score + "â–‘" * (10 - score)
                print(f"{metric:15} {bar} {score:2}/10")
            
            print(f"{'æ€»åˆ†':15} {total:2}/60 ({percentage:5.1f}%)")
            
            if percentage >= 90:
                print("ç­‰çº§ï¼šâ­â­â­â­â­ ä¼˜ç§€")
            elif percentage >= 75:
                print("ç­‰çº§ï¼šâ­â­â­â­ è‰¯å¥½")
            elif percentage >= 60:
                print("ç­‰çº§ï¼šâ­â­â­ å¯æ¥å—")
            else:
                print("ç­‰çº§ï¼šâ­â­ éœ€è¦æ”¹è¿›")
        
        # å¯¹æ¯”å’Œæ’å
        print("\n" + "="*80)
        print("ç‰ˆæœ¬å¯¹æ¯”")
        print("="*80)
        
        results.sort(key=lambda x: x["percentage"], reverse=True)
        
        for rank, result in enumerate(results, 1):
            print(f"{rank}. {result['name']:20} {result['percentage']:5.1f}% ({result['total']}/60)")
        
        # æ”¹è¿›å»ºè®®
        print("\n" + "="*80)
        print("æ”¹è¿›å»ºè®®")
        print("="*80)
        
        best = results[0]
        worst = results[-1]
        
        print(f"\næœ€å¥½çš„ç‰ˆæœ¬ï¼š{best['name']}")
        print(f"æœ€éœ€è¦æ”¹è¿›çš„ç‰ˆæœ¬ï¼š{worst['name']}")
        print(f"\næ”¹è¿›ç©ºé—´ï¼š{best['percentage'] - worst['percentage']:.1f}%")
        
        print("\nå»ºè®®çš„æ”¹è¿›æ–¹å‘ï¼š")
        for result in results:
            scores = result["scores"]
            lowest_metrics = sorted(scores.items(), key=lambda x: x[1])[:2]
            print(f"\n{result['name']}:")
            for metric, score in lowest_metrics:
                print(f"  - æ”¹è¿›{metric}: å½“å‰{score}/10")

def main():
    """è¿è¡ŒPromptä¼˜åŒ–å®æˆ˜"""
    print("\n" + "="*80)
    print("Promptä¼˜åŒ–å®æˆ˜ï¼šæŠ€æœ¯æ”¯æŒPromptæ¼”è¿›")
    print("="*80)
    
    optimizer = PromptOptimization()
    
    # å‡†å¤‡æ‰€æœ‰ç‰ˆæœ¬
    versions = [
        ("ç‰ˆæœ¬1ï¼šåŸºç¡€Prompt", optimizer.BASIC_PROMPT),
        ("ç‰ˆæœ¬2ï¼šæ·»åŠ è§’è‰²å’Œç›®çš„", optimizer.IMPROVED_PROMPT_V1),
        ("ç‰ˆæœ¬3ï¼šæ·»åŠ ReActæ¡†æ¶", optimizer.IMPROVED_PROMPT_V2),
        ("ç‰ˆæœ¬4ï¼šæ·»åŠ å·¥å…·å’Œçº¦æŸ", optimizer.IMPROVED_PROMPT_V3),
        ("ç‰ˆæœ¬5ï¼šé«˜è´¨é‡ç‰ˆæœ¬", optimizer.IMPROVED_PROMPT_V4),
    ]
    
    # è¯„ä¼°æ‰€æœ‰ç‰ˆæœ¬
    evaluations = []
    for name, prompt_text in versions:
        evaluation = optimizer.evaluate_prompt_quality(prompt_text, name)
        evaluations.append(evaluation)
    
    # æ‰“å°æŠ¥å‘Š
    optimizer.print_evaluation_report(evaluations)
    
    # è¯¦ç»†å¯¹æ¯”
    print("\n" + "="*80)
    print("è¯¦ç»†ç‰ˆæœ¬å¯¹æ¯”ï¼šæˆé•¿è¿‡ç¨‹")
    print("="*80)
    
    comparisons = [
        ("ä»ç‰ˆæœ¬1åˆ°ç‰ˆæœ¬2çš„æ”¹è¿›", 
         "æ·»åŠ äº†æ˜ç¡®çš„è§’è‰²å’Œç›®æ ‡å®šä¹‰\nè§’è‰²clarityæå‡äº†30%"),
        ("ä»ç‰ˆæœ¬2åˆ°ç‰ˆæœ¬3çš„æ”¹è¿›",
         "æ·»åŠ äº†ReActæ¡†æ¶\nä½¿å¾—æµç¨‹æ›´åŠ æ¸…æ™°ï¼Œactionableæå‡äº†40%"),
        ("ä»ç‰ˆæœ¬3åˆ°ç‰ˆæœ¬4çš„æ”¹è¿›",
         "æ·»åŠ äº†å·¥å…·å’Œçº¦æŸ\n safetyæå‡äº†50%ï¼Œcompletenessæå‡äº†25%"),
        ("ä»ç‰ˆæœ¬4åˆ°ç‰ˆæœ¬5çš„æ”¹è¿›",
         "æ·»åŠ äº†è¯¦ç»†ç¤ºä¾‹å’Œå®‰å…¨æç¤º\næ•´ä½“è´¨é‡æå‡äº†35%ï¼Œexamplesæå‡äº†300%"),
    ]
    
    for title, description in comparisons:
        print(f"\nã€{title}ã€‘")
        print(description)
    
    # æœ€ç»ˆå»ºè®®
    print("\n" + "="*80)
    print("Promptä¼˜åŒ–å…³é”®è¦ç‚¹")
    print("="*80)
    print("""
1. ä»åŸºç¡€åˆ°å“è¶Šçš„é€’è¿›è¿‡ç¨‹
   â”œâ”€ åŸºç¡€ç‰ˆæœ¬ï¼šæœ€å°åŒ–åŠŸèƒ½
   â”œâ”€ æ”¹è¿›ç‰ˆæœ¬1ï¼šæ·»åŠ æ¸…æ™°åº¦
   â”œâ”€ æ”¹è¿›ç‰ˆæœ¬2ï¼šæ·»åŠ ç»“æ„ï¼ˆReActï¼‰
   â”œâ”€ æ”¹è¿›ç‰ˆæœ¬3ï¼šæ·»åŠ çº¦æŸå’Œå·¥å…·
   â””â”€ æ”¹è¿›ç‰ˆæœ¬4ï¼šæ·»åŠ å®‰å…¨æ€§å’Œç¤ºä¾‹

2. å…³é”®æ”¹è¿›ç‚¹
   âœ“ ç‰ˆæœ¬1â†’2: è§’è‰²å®šä¹‰ (+30%)
   âœ“ ç‰ˆæœ¬2â†’3: æµç¨‹æ¡†æ¶ (+40%)
   âœ“ ç‰ˆæœ¬3â†’4: å·¥å…·å’Œçº¦æŸ (+50%)
   âœ“ ç‰ˆæœ¬4â†’5: ç¤ºä¾‹å’Œå®‰å…¨ (+35%)

3. é«˜è´¨é‡Promptçš„å¿…è¦æ¡ä»¶
   âœ“ æ¸…æ™°çš„è§’è‰²å’Œç›®æ ‡
   âœ“ æ˜ç¡®çš„èƒ½åŠ›å’Œé™åˆ¶
   âœ“ ç³»ç»Ÿçš„å·¥ä½œæµç¨‹
   âœ“ ä¸°å¯Œçš„å…·ä½“ç¤ºä¾‹
   âœ“ å……åˆ†çš„å®‰å…¨è€ƒè™‘
   âœ“ æ¸…æ™°çš„è¾“å‡ºæ ¼å¼

4. å®ç”¨å»ºè®®
   - å§‹ç»ˆä»åŸºç¡€ç‰ˆæœ¬å¼€å§‹
   - é€æ­¥æ·»åŠ å¤æ‚æ€§
   - åœ¨æ¯ä¸€æ­¥è¯„ä¼°è´¨é‡
   - ä¸è¿½æ±‚å®Œç¾ï¼Œè¿½æ±‚æœ‰æ•ˆ
   - æ ¹æ®åé¦ˆæŒç»­æ”¹è¿›

5. æµ‹è¯•ç­–ç•¥
   - ç”¨ç®€å•é—®é¢˜æµ‹è¯•
   - ç”¨å¤æ‚é—®é¢˜æµ‹è¯•
   - ç”¨è¾¹ç•Œæƒ…å†µæµ‹è¯•
   - ç”¨çœŸå®ç”¨æˆ·æµ‹è¯•
   - æ”¶é›†åé¦ˆå¹¶è¿­ä»£
""")

if __name__ == "__main__":
    main()
